<span id="review-container">
	<set last_level="0">
	<set odd_even="1">
	<ul class="review">
	<repeat group="{{ @story_reviews }}" value="{{ @item }}">
		<check if="{{@last_level==@item.level}}">
			</li>
		</check>
		<check if="{{@last_level<@item.level}}">
			<ul class="review">
		</check>
		<check if="{{@last_level>@item.level}}">
			<loop from="{{ @k=@last_level }}" to="{{ @k > @item.level }}" step="{{ @k-- }}"></li></ul></loop>
		</check>
		{* make sure odd and even iterate from top to bottom, not my the DOM structure *}
		<check if="{{(@odd_even++) % 2 == 0}}">
			<true><li class="review even"></true>
			<false><li class="review odd"></false>
		</check>
		<a id="r{{@item.id}}"></a>{{@item.name}} - {{ @item.level }} __Chapter {{@item.chapternr}}/{{@item.id}}
			<check if="{{ @_SESSION.userID OR TRUE==@CONFIG.allow_guest_reviews }}">
				<check if="{{ @_SESSION.userID > 0 AND @_SESSION.userID == @item.uid }}">
					<true>
						<a href="{{@BASE}}/userCP/feedback/reviews/written/edit/id=ST,{{@item.id}}/returnpath={{@returnpath}}">{ICON:edit}</a>
					</true>
					<false>
						<check if="{{isset(@item.id)}}"><span id="{{@item.id}}" data-level="{{@item.level}}" data-story="{{@item.story}}" data-chapter="{{@chapter}}" class="openform"><input class="button" type="submit" value="__Comment"></span></check>
					</false>
				</check>
			</check>
			<check if="{{isset(@item.elements) AND @item.elements>0}}"><a href="{{@BASE}}/story/read/{{@item.story}},{{@selection}},{{@item.id}}#r{{@item.id}}">XXX {{@item.elements}}</a></check>
			<br/>
			{{@item.text |raw}}
			<div class="ajaxform"></div>
		<set last_level="{{@item.level}}">
	</repeat>
	</ul>
	<check if="{{empty($no_review)}}">
		<span id="new" data-level=0 data-story="{{@data.story.sid}}" data-chapter="{{@chapter}}" class="openform"><input class="button" type="submit" value="__Comment"></span>
	</check>
</span>