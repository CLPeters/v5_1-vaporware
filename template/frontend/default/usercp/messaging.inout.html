<fieldset>
	<legend>{{@WHICH}}</legend>
	<table class="pm-box" width="100%">
		<colgroup>
			<col width='10%'>
			<col width='15%'>
			<col width='45%'>
			<col width='20%'>
			<col width='10%'>
		</colgroup>
		<tr>
			<td>&nbsp;</td>
			<td><span class="fa fa-calendar"></span> {{@DATE_MEANS}}</td>
			<td><span class="fa fa-file-text-o"></span> __Subject</td>
			<td><span class="fa fa-user"></span> {{@PERSON_IS}}</td>
			<td>&nbsp;</td>
		</tr>

<check if="{{ sizeof(@messages) > 0 }}">
	<true>
{* show all messages, line by line *}
<repeat group="{{ @messages }}" value="{{ @pm_line }}">
		<tr>
			{* check if mail has been read *}
			<td><check if="{{ @pm_line['date_read']!==NULL }}">
					<true><span class="fa fa-envelope-o" title="{{ date(\Base::instance()->get('CONFIG')['date_format_short'],@pm_line['read']) }}"></span></true>
					<false><span class="fa fa-envelope" title="__unread"></span></false>
			</check></td>
			<td>{{ date(\Base::instance()->get('CONFIG')['date_format_short'],@pm_line['date_sent']) }}</td>
			<td><a href="{{@BASE}}/userCP/messaging/read,{{ @pm_line['mid'] }}">{{ @pm_line['subject'] }}</a></td>
			<td><check if="{{ @pm_line['date_read']!==NULL }}">
				<true><a href="__baseURL?action=controlpanel&amp;module=viewprofile&amp;uid={{ @pm_line['name_id'] }}">{{ @pm_line['name'] }}</a></true>
				<false>{{ @pm_line['name'] }}</false>
			</check></td>
			{* check if mail can be deleted (inbox always, outbox only if not read by recipient *}
			<td><check if="{{ @pm_line['can_delete'] }}">
						<true><span class="fa fa-trash-o delete" id="{{ @pm_line['mid'] }}"></span></true>
						<false>&nbsp;</false>
			</check></td>
		</tr>
</repeat>
{* END all messages *}
	</true>
	<false>
		<tr>
			<td colspan="4">__Your{{@WHICH}} __isEmpty</td>
		</tr>
	</false>
</check>

	</table>
</fieldset>

<div id="delete-confirm" title="Delete message?" style="display:none">
  <p><span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span>__DeleteMessage. __Sure?</p>
</div>

<script type="text/javascript">
  $(document).ready(function() {
    $("#delete-confirm").dialog({
    	dialogClass: 'efi-dialog',
    	autoOpen: false,
    	modal: true,
    	buttons: {
    		__Cancel: function() {
    			$(this).dialog('close');
    		},
    		__OK: function() {
    	              window.location.href = "__baseURL?action=controlpanel&module=messaging,{MODULE}&delete="+element_id;
    		  $(this).dialog('close');
    		}
    	}
    });
    
    /* capture delete requests in in-/outbox */
    $('.pm-box .delete').click(function() {
    	element_id = $(this).attr('id');
    	$('#delete-confirm').dialog('open');
    });
    /* end */
    
    /* capture delete requests in view */
    $('input.delete').click(function() {
    	element_id = $(this).attr('id');
    	$('#delete-confirm').dialog('open');
    });
    /* end */
    
  });
</script>
